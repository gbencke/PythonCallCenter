<!doctype html>
<html>

        <head>
                <meta charset="UTF-8" />
                <title>Python no CallCenter</title>
                <link rel="stylesheet" href="./css/reveal.min.css" />
                <link rel="stylesheet" href="./lib/css/zenburn.css">
                <link rel="stylesheet" href="./css/theme/league.css" />
                <!--
                        <link rel="stylesheet" type="text/css" href="./css/print/pdf.css">
                -->
                <style>

body>div>div.slides>section.present>ul>li>strong {
        text-decoration: underline
}

                        body>div>div.slides>section.present>ul>li {
                                font-size: 32px !important
                        }
                        .texto-medio {
                                font-size: 32px !important;
                                overflow: hidden !important
                        }

                        .justificado {
                                text-align: justify !important;

                        }
                </style>
        </head>

        <body>
                <div class="reveal">
                        <!-- Any section element inside of this container is displayed as a slide -->
                        <div class="slides">

                                <section>
                                        <h2>Python no CallCenter</h2>
                                        <BR>
                                        <BR>
                                        <BR>
                                        <h3>Guilherme Bencke</h3>
                                        <h3>Porto Alegre - Agosto, 2018</h3>
                                        <br>
                                        <p><a href="https://github.com/gbencke/PythonCallCenter">github.com/gbencke/PythonCallCenter</a></p>
                                        <h5>Proudly made with <img src="i/Vimlogo.svg.png"/ width="32px" heigth="32px" border="0" style="border:0px; margin:0px 0px 0px 0px"></h5>
                                </section>


                                <section>
                                        <h2>Objetivo da Apresentação</h2>
                                        <p class="justificado">Muito tem se falado nas várias funcionalidades do Python como linguagem de programação e de seus potenciais, 
                                        mas, sinto a necessidade de demonstrar a versatilidade inerente do Python em termos de resolução de problemas
                                        reais numa empresa real de Callcenter</p>

                                        <p class="justificado">Ou seja, nessa apresentação eu irei falar sobre como aplicamos as técnicas do python em problemas reais e não nas técnicas em si</p>
                                </section>

                                <section>
                                        <h2>Quem sou Eu?</h2>
                                        <p class="justificado">Meu nome é Guilherme Bencke, e sou formado em Ciência da Computação pela ULBRA em 2003, programo desde 1986 e profissionalmente
                                        desde 1998. </p>

                                        <p class="justificado">Já trabalhei com dezenas de linguagens e tecnologias em projetos tanto para o Brasil, quanto EUA e França.</p>

                                        <p class="justificado">Atualmente (Dependendo do Dia) sou Desenvolvedor / Líder Técnico e Gerente de Desenvolvimento de Software.</p>
                                </section>

                                <section>
                                        <h2>Como Funciona um CallCenter?</h2>
                                        <p class="justificado">Um CallCenter, ou Contact Center, é uma empresa especializada em prestar o serviço de receber um conjunto de dados sobre pessoas
                                        a serem contactadas e realizar uma série de ações de contato com essas pessoas. </a>

                                <p class="justifiacado">A Zanc é uma empresa de CallCenter de Cobrança em que o objetivo do contato é o pagamento de uma dívida que um cliente tem com 
                                alguma empresa conveniada a Zanc para a cobrança dessa dívida. </p>
                                </section>

                                <section>
                                        <h2>Fluxo de Dados</h2>
                                        <img src="./i/Fluxo%20Callcenter.jpg" style="width: 80%; height: 80%" />
                                </section>

                                <section>
                                        <h2>Desafios nos Fluxos de Dados</h2>
                                        <p style="font-size:24px" class="justificado">Basicamente um CallCenter enriquece, filtra, segmenta, gera listas de contato e executa esses contatos. Atualmente existem
                                        diversos desafios no dia a dia da empresa, principalmente relacionado com:</p>
                                        <ul>
                                                <li><strong>Recepção de Dados</strong>: A Zanc atende em torno de 40 convênios através de 4 CRMs e usando 2 Discadores, cada um desses convênios
                                                        disponibiliza diariamente dados atualizados para contato para cada um dos clientes a serem acionados. Em geral, esses dados vem 
                                                        em diversos formatos de texto, que podem ser mudados de uma hora para outra pela empresa conveniada, e muitas vezes sem nenhum
                                                        aviso, e os nossos CRMs dependem de um tamanho de formato de importação relativamente fixo. Essa atividade de recepção de dados
                                                        é realizada por pessoas sem formação técnica em programação ou processamento de dados.</li>
                                        </ul>
                                </section>
                                <section>
                                        <h2>Desafios nos Fluxos de Dados (2)</h2>
                                        <ul>
                                                <li><strong>Análise de Dados</strong>: Telefonia é o segundo maior gasto de uma empresa de callcenter, então na realidade o lucro da empresa é minimizar
                                                        o custo com telefonia, ou seja, apenas ligar para pessoas em que realmente esse contato possa surtir efeito. Para tanto, existe um setor 
                                                        de Análise de Dados que prioriza os clientes a serem acionados As pessoas que executam essa análise não tem
                                                        formação em programação.</li>
                                                <li><strong>Localização de Clientes</strong>: Como utilizamos diversas ferramentas de CRM e discadores, existe uma dificuldade imensa de consolidar os dados
                                                        sobre cada um dos CPFs na base de dados, uma vez que um cliente pode estar devendo para várias empresas conveniadas ao mesmo tempo, e a 
                                                        informação de acionamento de um CRM pode e deve ser usada por outro CRM de outro convênio.</li>
                                        </ul>
                                </section>
                                <section>
                                        <h2>Porque Python?</h2>
                                        <p class="justificado">Podemos ver que a maior parte dos fluxos de dados dentro da empresa tem a necessidade de pequenos ajustes de programação diários e que
                                        devem ser feitos no momento em que o problema é detectado.</p>

                                        <p class="justificado">A Empresa sempre usou bastante .NET e PHP nos seus processos internos, mas, existe a necessidade de treinar pessoas sem formação em 
                                        programação para que programassem pequenos programas para pequenos tratamentos de arquivos e de ajustes em dados ou análises.</p>

                                </section>
                                <section>
                                        <h2>Porque Python? (2)</h2>
                                        <p class="justificado">Nesse quesito de ser uma linguagem de fácil aprendizado, versatil tanto na parte de análise de dados, como tratamento deles, além de 
                                        possibilidade de servir web e rodar em qualquer plataforma, fez com que selecionassemos o python como "lingua franca" da empresa.</p>

                                        <p class="justificado">Atualmente todos os futuros desenvolvimentos de sofware da empresa são feitos em python.</p>
                                </section>
                                <section>
                                        <h2>Python na Recepção de Dados</h2>

                                        <p class="justificado">A Vasta maioria dos dados é recepcionado por arquivos de texto, esses arquivos de texto são recepcionados por FTP em diversos formatos como
                                        CSV, delimitado, campo fixo entre outros. Esses arquivos tem em geral centenas de campos que podem mudar de uma hora para outra. Também existe
                                        muitas vezes a necessidade de se cruzar dados com os que estão no banco de dados do CRM pois algumas empresas conveniadas mandam dados duplicados
                                        ou em ordem errada, oque é necessário fazer uma validação interna antes da carga.</p>
                                </section>
                                <section>

                                        <p class="justificado">Antes de 2017 diversas pessoas importavam esses arquivos em excel, e gastavam dias para processa-los e valida-los.  
                                        Decidimos criar um treinamento interno de python para treinar pessoas, que não conheciam programação para que possam abrir os arquivos de texto
                                        e realizar as validações necessárias, inclusive acessando os dados no banco de dados do CRM. E atualmente mesmo quando a necessidade de ajustes
                                        no tratamento dos arquivos, essa operação leva algumas horas em vez de alguns dias.</p>
                                </section>
                                <section>
                                        <p class="justificado">Esse treinamento está disponível no github: </p>
                                        <BR>
                                        <p><a href="https://github.com/gbencke/PythonFlatFilesProcessingCourse">https://github.com/gbencke/PythonFlatFilesProcessingCourse</a></p>
                                        <BR>
                                        <p class="justificado">Importante Salientar que as pessoas que realizaram esse curso jamais tinham programado antes.</p>
                                </section>

                                <section>
                                        <h2>Python na Análise dos Dados</h2>

                                        <p class="justificado">Uma vez carregado os dados para dentro do CRM, é necessário que se faça a análise de quais clientes serão acionados ou não, oque gera o arquivo
                                        de mailing que é carregado no discador que efetua as ligações, uma vez o cliente atendendo, essa ligação é passada para um atendente que efetua o contato.</p>

                                        <p class="justificado">Essa é uma área rica para machine learning, pois é necessário encontrar os padrões que melhor definem os clientes potenciais e gerar um score.</p>
                                </section>
                                <section>
                                        <p class="justificado">Para isso, o Python tem nos ajudado no sentido de usar a biblioteca XGBoost que cria arvores de decisão que geram um score de diversas variáveis com a 
                                        probrabilidade do cliente atender o telefone, a probabilidade dele honrar os pagamentos, entre outros. Antes usavamos R para isso, mas, nosso conhecimento
                                        com R era limitado a poucas pessoas.</p>

                                </section>
                                <section>
                                        <p class="justificado">Temos 2 projetos piloto utilizando python para machine learning nessa area:</p>
                                        <ul>
                                                <li><strong>Herval Deep Mailing</strong> - Para cálculo de propensão de pagamentos da carteira Herval (Usando XGBoost)<BR><a href="https://github.com/gbencke/HervalDeepMailing">https://github.com/gbencke/HervalDeepMailing</a></li>
                                                <BR>
                                                <li><strong>Deep Mailing</strong> - Para cálculo de probabilidade de atendimento de ligação da carteira ITAUCARD (Usando XGBoost)<BR><a href="https://github.com/gbencke/DeepMailing">https://github.com/gbencke/DeepMailing</a></li>
                                        </ul>
                                </section>
                                <section>
                                        <h2>Python na Localização</h2>
                                        <p class="justificado">Como falamos anteriormente, um cliente pode estar em diversos convenios ao mesmo tempo, então é fundamental que as ocorrencias entre os CRMs sejam compartilhados.
                                        Isso é extremamente crítico no caso da localização de telefones onde um cliente pode ter 5 telefones num CRM que atende uma empresa, mas, o mesmo cliente pode
                                        estar cadastrado em outro CRM de outro Convênio com outros telefones. E existe uma oportunidade de economia se não discamos os telefones de um cliente num CRM, se
                                        sabemos que esse cliente já foi discado por outro CRM em outro convênio</p>
                                </section>
                                <section>
                                        <p class="justificado">Para resolver isso temos uma base de localização com todas as ligações efetuadas por todos os CRMs e para todos os telefones de todos os clientes. Atualmente essa
                                        base tem em torno de 500 milhoes de ligacoes com milhoes de telefones cadastrados.</p>

                                        <p class="justificado"A Solução original era acesso direto ao banco por stored procedures em postgres, oque era pesado, não era escalável e tinha diversos problemas com a modelagem de dados
                                        feito.</p>

                                        <p class="justificado">Essa aplicação está sendo rescrita usando banco de dados postgresql, mas, com um web server tornado usando o async do python 3.6, uma vez que todas as ligações de toda
                                        a empresa são cadastradas nessa base é possível ter milhares de conexões e atualizações simultâneas, oque o async nos pareceu a melhor solução.</a>
                                </section>
                                <section>
                                        <h2>Discador</h2>
                                        <p class="justificado">Mas, o principal impacto que a utilização do python na nossa empresa trouxe foi no discador, que é o software que realiza a ligação ao cliente final, que identifica se
                                        ocorreu o alô dele, e passa para um operador para realizar a ligação. </p>

                                        <p class="justificado">Nossa solução atual foi feita em 2005, em .NET, mas, infelizmente com o tempo se mostrou inadequada e estamos trocando a arquitetura da discagem em si de .NET para python, oque 
                                        veremos nos próximos slides.</p>
                                </section>
                                <section>
                                        <h2>Oque é o Multcall</h2>
                                        <p class="justificado">O Multcall é o sistema discador desenvolvido pela própria zanc pelos ultimos 10 anos. Ele é escrito em .NET e utiliza um banco de dados SQL Server
                                        tanto para os dados internos da aplicação quanto os dados do négócio (Clientes, Ligações, Contatos, etc...)</p>
                                        <p class="justificado">Atualmente a Zanc tem testado diversos outras plataformas de discagem, mas, o retorno ao negócio não tem sido significativo o suficiente para
                                        justificar o custo adicional de licenças de um software terceiro.</p>
                                </section>

                                <section>
                                        <h2>Arquitetura Atual do MultCall 1.0
                                        </h2>
                                        <img src="./i/Arquitetura.Multcall1.0.jpg" style="width: 80%; height: 80%" />
                                </section>

                                <section>
                                        <h2>Problemas com o Multcall 1.0
                                        </h2>
                                        <p class="justificado">Com o passar do tempo, as limitações do Multcall 1.0 começaram a aparecer.
                                        Em termos concretos, os problemas do Multcall Atualmente são:</p>

                                        <ul style="font-size: 24px">
                                                <li><strong>Escalabilidade</strong>: Capacidade de fácilmente aumentar o número de operadores logados.</li>
                                                <li><strong>Versao Asterisk</strong>: Atrelamento fixo do Multcall a uma específica versão do Multcall</li>
                                                <li><strong>Balanceamento de Carga</strong>: Dificuldade em distribuir a carga de ligações entre diversas centrais.</li>
                                        </ul>

                                </section>

                                <section>
                                        <h2>Escalabilidade 
                                        </h2>
                                        <p class="justificado">Um dos grandes problemas com o Multcall 1.0 é que o mesmo banco de dados serve tanto para os dados do negocio quanto para os dados
                                        internos da aplicação (Direitos, Operadores Disponiveis, Filas de Discagem, etc...), dessa forma, o quanto mais operadores você colocar em uma
                                        operação, mais o sistema irá ter a sua performance degradada. </p>
                                </section>

                                <section>
                                        <h2>Versão Asterisk
                                        </h2>
                                        <p class="justificado">A Versão atual do MultCall conecta o codigo .NET diretamente a Central Telefonica, oque causa 2 problemas:</p>
                                        <ul style="font-size: 24px">
                                                <li>Não existe suporte oficial do Asterisk ao .NET, dessa forma, deve haver uma "Adaptação" de bibliotecas terceiras para que funcione corretamente</li>
                                                <li>Essa adaptação tem que ser testada em todas as versões do Asterisk, pois não é garantido que funcionará em todas as situações.</li>
                                        </ul>
                                </section>

                                <section>
                                        <h2>Balanceamento de Carga
                                        </h2>
                                        <p class="justificado">Atualmente para balanceamento de carga, o Multcall se conecta com o AsteriskProxy que é um programa provido pelo próprio asterisk para balanceamento
                                        e distribuição de carga. Esse software não é mais suportado pelo Asterisk, oque causa uma série de problemas de suporte, além desse programa ser relativamente instável oque causa paradas na operação.</p>
                                </section>


                                <section>
                                        <h2>Arquitetura MultCall 2.0
                                        </h2>
                                        <img src="./i/Arquitetura.Multcall.2.0.jpg" style="width: 80%; height: 80%" />
                                </section>


                                <section>
                                        <h2>Multcall 2.0
                                        </h2>
                                        <p class="justificado">Como podemos ver na figura anterior, para resolver os 3 problemas atuais do Multcall, criamos uma camada intermediaria entre o multcall e a central aonde
                                        colocar um banco de dados de alta performance chamada Redis.</p>
                                        <p class="justificado">Dessa forma, o Multcall escreve no banco de dados Redis sem contato com a central telefonica em si, e na central telefonica instalamos um script em python que realiza a discagem propriamente dita.</p>
                                </section>

                                <section>
                                        <h2>Redis (1)
                                        </h2>
                                        <p class="justificado">Redis é um banco de dados do tipo "Chave-Valor", ou seja, Não-SQL, de alto desempenho e que roda em memória. Objetivo dele é armazenar e disponibilizar
                                        rapidamente os dados internos da aplicação, ou seja, aqueles dados que não interessam ao Negócio, ao NEC, e que jamais serão alvos de Relatorios.</p>
                                </section>

                                <section>
                                        <h2>Redis (2)
                                        </h2>
                                        <p class="justificado">Por ele não permitir consultas em "Massa" como no SQL, e sim um valor apenas por vez, ele é muito escalavel e dificilmente tem problemas de sobrecarga, ao contrario do SQL Server, em que operações de Gerenciamento podem ter impacto na performance do sistema como um todo.</p>
                                </section>


                                <section>
                                        <h2>Python
                                        </h2>
                                        <p class="justificado">Atualmente, a interface padrão com o Asterisk é feita através da linguagem de programação Python, ela é suportada em todas as versões do Asterisk tanto
                                        presentes, passadas quanto futuras.</p>
                                        <p class="justificado">O fluxo de controle das ligações fica no python que usa uma série de filas do Redis para comunicação com o Discador.
                                        Usando o Redis como meio de comunicação entre o discador e a central, e usando o python dentro da Central, podemos garantir que o Mulcall 2.0 irá funcionar em qualquer versão presente, passado e futura do Asterisk</p>
                                </section>

                                <section>
                                        <h2>Fluxo de Filas do Redis</h2>
                                </section>

                                <section>
                                        <img src="./i/FluxoFilasRedis.jpg" style="width: 70%; height: 70%" />
                                </section>


                                <section>
                                        <h2>Gestão do Multcall 
                                        </h2>
                                        <p class="justificado">Em termos de Gestão do Multcall, nada muda, tudo continua nas mesmas telas e o detalhe de se usar os DialWorkers ou o Redis para comunicação com a
                                        Central é apenas uma questão interna de configuração. Existem 5 parametros que configuram o Multcall para usar o REDIS:</p>
                                </section>


                                <section>
                                        <h2>Execução do Python na Central
                                        </h2>

                                        <p class="justificado">Uma vez instalado o redis, podemos ir para o diretorio criado pelo git clone e executar </p>

                                        <blockquote class="">.\run.sh $NomeCelula</blockquote>

                                        <p class="justificado">Aonde NomeCelula é o numero da celula configurado no arquivo settings.py do diretorio src/settings.py</p>
                                </section>

                                <section>
                                        <h2>Monitoramento das Filas do Redis (1)
                                        </h2>
                                        <p class="justificado">Para monitoramento das filas do Redis, e detecção de qualquer gargalo ou sobrecarga, foi desenvolvido um simples programa de 
                                        monitoramento. Ele é bastante simples, apenas informar o servidor e o intervalo de atualização desejado e clicar em iniciar e
                                        o programa irá mostrar em tempo real todas as informações armazenadas no Redis como em demonstrado embaixo:</p>
                                </section>
                                <section>
                                        <h2>Monitoramento das Filas do Redis (2)
                                        </h2>
                                        <img src="./i/redismonitor.png" style="width: 80%; height: 80%" />
                                </section>

                                <section>
                                        <h2>Conclusão e Trabalhos Futuros
                                        </h2>
                                        <p class="justificado">Criando uma camada intermediária entre a Central e o Multcall, conseguimos resolver dessa forma, uma série de problemas que comprometiam o seu uso na operação no dia-a-dia. Os proximos passos sao:</p> 
                                        <ul style="font-size: 24px">
                                                <li>Mover todos os dados internos da aplicação para fora do SQL Server e para o Redis</li>
                                                <li>Implantar a metodologia apresentada na discagem Preditiva</li>
                                                <li>Trocar o numero fixo de threads por Async usando Python 3.6</li>
                                        </ul>

                                </section>
                        </div>

                </div>
                <script src="./lib/js/head.min.js"></script>
                <script src="./js/reveal.min.js"></script>
                <script>
                        Reveal.initialize({
                                // Display controls in the bottom right corner
                                controls: true,
                                // Display a presentation progress bar
                                progress: true,
                                // If true; each slide will be pushed to the browser history
                                history: true,
                                // Loops the presentation, defaults to false
                                loop: false,
                                // Flags if mouse wheel navigation should be enabled
                                mouseWheel: true,
                                // Apply a 3D roll to links on hover
                                rollingLinks: true,
                                // UI style
                                theme: Reveal.getQueryHash().theme || 'default',
                                // Transition style
                                transition: 'Fade',
                                pdfMaxPagesPerSlide: 1,

                                dependencies: [{
                                        src: './plugin/highlight/highlight.js',
                                        async: true,
                                        callback: function () {
                                                hljs.initHighlightingOnLoad();
                                        }
                                }]
                        });
                </script>
                <script type="text/javascript" src="./plugin/highlight/highlight.js"></script>
        </body>

</html>
